---
title: "Analysis NoteBook"
author: "Andrew Taylor"
date: "7/25/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Analysis Notebook
This is notebook for calculations for the analysis in the report. In theory, you should just be able to run these code chunks and return the correlations requested per whatever specific access index we want. 

###RDS Pull
```{r}
library(rgeos)
library(rgdal)
library(raster)
library(tidyverse)
library(RPostgreSQL)
# loads the PostgreSQL driver
drv <- dbDriver("PostgreSQL")

# creates a connection to the postgres database
# note that "con" will be used later in each connection to the database
con <- dbConnect(drv, dbname = "dssg2018uw",
                 host = "localhost", port = 9000,
                 user = user, password = password) #local source credentials

#get reschool_programs
#reschool_programs <- dbGetQuery(con, "select * from clean.reschool_summer_programs")
acs_demographics <- dbGetQuery(con, "select * from clean.acs_demographics")

#disconnect
dbDisconnect(con) 
dbUnloadDriver(drv)
```

###Census Merge
```{r}
#pre acs for merge
acs_demographics$id2 <- as.numeric(acs_demographics$id2)
acs_demographics <- acs_demographics[order(acs_demographics$id2),]
colnames(acs_demographics)[colnames(acs_demographics)=="id2"] <- "Id2"

#merge access index with census block data
driving_index <- driving_index[order(driving_index$Id2),]
acs_driving_AI <- merge(driving_index,acs_demographics,by="Id2")

#make an overall column
acs_driving_AI$AI_overall <- rowMeans(acs_driving_AI[,c("AI_has_nature_anycost",'AI_has_sports_anycost','AI_art_anycost','AI_academic_anycost')])
```

###Census Race Correlations
```{r}
library(haven)
#cor at different values
acs_driving_AI$pct_white <- acs_driving_AI$pct_white/100
acs_driving_AI$pct_african <- acs_driving_AI$pct_african/100
acs_driving_AI$pct_americanindian <- acs_driving_AI$pct_americanindian/100
acs_driving_AI$pct_asian <- acs_driving_AI$pct_asian/100
acs_driving_AI$pct_hispanic <- acs_driving_AI$pct_hispanic/100

#Stat Sig
white_cor <- cor.test(acs_driving_AI$pct_white, acs_driving_AI$AI_overall, method=c("pearson"))
black_cor <- cor.test(acs_driving_AI$pct_african, acs_driving_AI$AI_overall, method=c("pearson"))
hsp_cor <- cor.test(acs_driving_AI$pct_hispanic, acs_driving_AI$AI_overall, method=c("pearson"))


#Not Stat Sig
asn_cor <- cor.test(acs_driving_AI$pct_asian, acs_driving_AI$AI_overall, method=c("pearson"))
AmI_cor <- cor.test(acs_driving_AI$pct_americanindian, acs_driving_AI$AI_overall, method=c("pearson"))
PcI_cor <- cor.test(acs_driving_AI$pct_pacificislander,acs_driving_AI$AI_overall,method=c("pearson"))
```

###Income Correlations
Add single mom & dad? / Single parent? 
```{r}
acs_driving_AI$poverty_pct_hh <- acs_driving_AI$poverty_pct_hh/100

#sig
median_income_cor <- cor.test(acs_driving_AI$median_hh_income,acs_driving_AI$AI_overall,method=c("pearson"))

#not sig
poverty_cor <- cor.test(acs_driving_AI$poverty_pct_hh,acs_driving_AI$AI_overall,method=c("pearson"))
```

###Language Correlations
```{r}
#make percent of ESLs
acs_driving_AI$pcnt_english <- acs_driving_AI$lng_english/acs_driving_AI$ttpop_18plus_lng
acs_driving_AI$pcnt_ESL <- 1-acs_driving_AI$pcnt_english

ESL_cor <- cor.test(acs_driving_AI$pcnt_ESL,acs_driving_AI$AI_overall,methods=c("pearson"))
```

###Geospatial Regression To Return Effect of race on access?
Why? Besides that you want to do it what is the value?
```{r}

```

